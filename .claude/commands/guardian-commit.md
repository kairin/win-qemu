---
description: Fully automatic constitutional Git commit - analyzes changes, generates perfect commit message, creates timestamped branch, commits, merges to main - FULLY AUTOMATIC
---

## Purpose

**AUTO-COMMIT**: Analyze uncommitted changes, generate perfect constitutional commit message, execute timestamped branch workflow with zero manual intervention.

## User Input

```text
$ARGUMENTS
```

**Note**: User input is OPTIONAL. If provided, used as additional context for commit message.

## Automatic Workflow

You **MUST** invoke the **master-orchestrator** agent to coordinate the auto-commit workflow.

Pass the following instructions to master-orchestrator:

### Phase 1: Change Analysis (Parallel - 2 Tasks)

**Task 1: Git Status Analysis**
```bash
# Identify all changes
git status --porcelain
git status --short

# Separate staged vs unstaged
git diff --cached --name-only  # Staged files
git diff --name-only           # Unstaged files
```

**Task 2: Change Content Analysis**
```bash
# Analyze what changed
git diff --cached              # Staged content
git diff                       # Unstaged content

# Get file statistics
git diff --cached --stat
git diff --stat
```

**Output Required**:
- List of modified files (with paths)
- Type of changes (add/modify/delete)
- Lines changed per file
- Content summary

### Phase 2: Auto-Generate Commit Details (Single Task)

**Automatic Detection Rules**:

**Commit Type** (auto-detect based on files):
```
If files match:
  .claude/agents/*.md ‚Üí feat (agent system)
  .claude/commands/*.md ‚Üí feat (slash commands)
  scripts/*.sh ‚Üí feat (automation scripts)
  configs/*.xml ‚Üí config (VM configurations)
  research/*.md ‚Üí docs (research documentation)
  outlook-linux-guide/*.md ‚Üí docs (implementation guides)
  AGENTS.md, README.md ‚Üí docs (core documentation)
  .gitignore, .env.example ‚Üí config (configuration)
```

**Scope** (auto-extract):
- From directory: .claude/agents/ ‚Üí scope: agents
- From directory: .claude/commands/ ‚Üí scope: commands
- From directory: scripts/ ‚Üí scope: scripts
- From directory: configs/ ‚Üí scope: configs
- From directory: research/ ‚Üí scope: research
- From file type: Multiple types ‚Üí scope: repo

**Short Description** (auto-generate):
```
Extract from:
1. File names (remove extensions, join with dashes)
2. Common theme (e.g., "qemu-health-checker-implementation")
3. Primary change (e.g., "vm-xml-template-update")

Format: kebab-case, 2-5 words max
Examples:
  - "qemu-health-checker-agent"
  - "guardian-commands-suite"
  - "vm-performance-optimization"
```

**Commit Message** (auto-generate):
```
Format:
type(scope): Brief summary (max 72 chars)

Problem/Context:
- Why this change was needed
- What issue it solves

Solution:
- What was changed
- Key improvements made

Technical Details:
- Files modified count
- Lines added/removed
- Major components affected

Validation:
- How it was tested
- Expected behavior

ü§ñ Generated with [Claude Code](https://claude.com/claude-code)

Co-Authored-By: Claude <noreply@anthropic.com>
```

**Example Auto-Generation**:
```
Files changed:
  .claude/agents/qemu-health-checker.md (+800 lines)
  docs-repo/HEALTH-CHECKER-EVALUATION-REPORT.md (+700 lines)
  .claude/commands/guardian-health.md (+400 lines)

Auto-detected:
  Type: feat (new features in agents and commands)
  Scope: agents (primary changes in .claude/agents/)
  Description: qemu-health-checker-implementation

Generated message:
feat(agents): Implement qemu-health-checker with guardian command suite

Problem/Context:
- First-time QEMU/KVM setup takes 8-11 hours due to manual prerequisite validation
- No automated readiness check before VM creation
- Cross-device setup requires repeating 3-5 hours of configuration

Solution:
- Created qemu-health-checker agent with 42 automated prerequisite checks
- Implemented /guardian-health slash command for system readiness validation
- Auto-generates device-specific setup guides
- Provides JSON reports for other agents to consume

Technical Details:
- 3 files modified
- +1,900 lines added
- Agent specification: qemu-health-checker.md (800 lines)
- Evaluation report: HEALTH-CHECKER-EVALUATION-REPORT.md (700 lines)
- Slash command: guardian-health.md (400 lines)

Validation:
- All 6 health check categories defined (42 items total)
- JSON report format validated
- Critical failure handling implemented
- Cross-device compatibility verified

ü§ñ Generated with [Claude Code](https://claude.com/claude-code)

Co-Authored-By: Claude <noreply@anthropic.com>
```

### Phase 3: Constitutional Git Workflow (Sequential)

**Agent**: **git-operations-specialist**

**Automatic Execution**:
```bash
# 1. Create timestamped branch
DATETIME=$(date +"%Y%m%d-%H%M%S")
TYPE="<auto-detected-type>"
DESCRIPTION="<auto-generated-description>"
BRANCH="${DATETIME}-${TYPE}-${DESCRIPTION}"

git checkout -b "$BRANCH"

# 2. Stage all changes
git add .

# 3. Commit with auto-generated message
git commit -m "<auto-generated-message>"

# 4. Push to remote
git push -u origin "$BRANCH"

# 5. Merge to main
git checkout main
git merge "$BRANCH" --no-ff -m "Merge branch '$BRANCH' into main"

# 6. Push main
git push origin main

# 7. Return to feature branch (NEVER delete)
git checkout "$BRANCH"
```

**Constitutional Requirements**:
- ‚úÖ Branch naming: YYYYMMDD-HHMMSS-type-description
- ‚úÖ Commit message: Multi-paragraph with context
- ‚úÖ Claude attribution: Automatic footer
- ‚úÖ Branch preservation: NEVER delete
- ‚úÖ Merge strategy: --no-ff (preserve history)

## Expected Output

```
ü§ñ AUTOMATIC COMMIT COMPLETE

Change Analysis:
- Files modified: 3
- Lines added: +1,900
- Lines removed: -0
- Net change: +1,900 lines

Auto-Generated Details:
Type: feat
Scope: agents
Branch: 20251117-180000-feat-qemu-health-checker-implementation
Message: "feat(agents): Implement qemu-health-checker with guardian command suite"

Git Workflow:
- ‚úÖ Branch created and pushed to origin
- ‚úÖ Changes committed with constitutional format
- ‚úÖ Merged to main with --no-ff
- ‚úÖ Main pushed to remote
- ‚úÖ Branch preserved (not deleted)

Constitutional Compliance: ‚úÖ 100%
```

## When to Use

Run `/guardian-commit` when you have:
- QEMU/KVM configuration changes (VM XML, libvirt network)
- Agent system updates (new agents, command modifications)
- Documentation updates (research, guides, AGENTS.md)
- Script modifications (automation, health checks)
- Any uncommitted changes needing constitutional commit

**Perfect for**: Quick commits without thinking about branch names or commit messages.

## What This Command Does NOT Do

- ‚ùå Does NOT run health checks (use `/guardian-health`)
- ‚ùå Does NOT create VMs (use `/guardian-vm`)
- ‚ùå Does NOT optimize performance (use `/guardian-optimize`)
- ‚ùå Does NOT harden security (use `/guardian-security`)

**Focus**: Git commit workflow only - analyzes changes, commits with perfect format.

## Constitutional Compliance

This command enforces:
- ‚úÖ Automatic commit type detection (feat, fix, docs, config)
- ‚úÖ Meaningful commit messages (not "Update files")
- ‚úÖ Constitutional branch naming (YYYYMMDD-HHMMSS-type-description)
- ‚úÖ Branch preservation strategy (NEVER delete)
- ‚úÖ Proper merge strategy (--no-ff)
- ‚úÖ Claude Code attribution
- ‚úÖ QEMU/KVM-specific commit categories (config for VM XML, etc.)
